<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì´ë™ ê²½ë¡œ í‘œì‹œ</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 500px; }
    #distance { margin-top: 10px; font-size: 18px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ğŸ“ ë‚´ ìœ„ì¹˜ì™€ ì´ë™ ê²½ë¡œ</h1>
  <div id="map"></div>
  <div id="distance">ì´ ì´ë™ ê±°ë¦¬: 0 m</div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ì§€ë„ ì´ˆê¸°í™” (ì„ì‹œ ì¢Œí‘œ: ì„œìš¸)
    const map = L.map('map').setView([37.5665, 126.9780], 13);

    // ì§€ë„ íƒ€ì¼ ë¶ˆëŸ¬ì˜¤ê¸° (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // ê²½ë¡œì™€ ê±°ë¦¬ ë³€ìˆ˜
    let path = [];
    let totalDistance = 0;

    // ë¹¨ê°„ìƒ‰ polyline ê°ì²´ ìƒì„±
    const polyline = L.polyline(path, { color: 'red' }).addTo(map);

    // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ (í•˜ë‚˜ë§Œ ìœ ì§€)
    let marker = L.marker([37.5665, 126.9780]).addTo(map).bindPopup("ğŸ“ í˜„ì¬ ìœ„ì¹˜");

    // ê±°ë¦¬ í‘œì‹œ DOM
    const distanceDiv = document.getElementById("distance");

    // ìœ„ì¹˜ ì¶”ì 
    navigator.geolocation.watchPosition(
      (pos) => {
        const { latitude, longitude } = pos.coords;
        const currentPos = [latitude, longitude];

        // ì§€ë„ ì¤‘ì‹¬ ì´ë™ (ì¤Œ ìœ ì§€)
        map.panTo(currentPos);

        // ë§ˆì»¤ ìœ„ì¹˜ ê°±ì‹ 
        marker.setLatLng(currentPos);

        // ê²½ë¡œ ë°°ì—´ì— ì¶”ê°€
        if (path.length > 0) {
          // ì´ì „ ì¢Œí‘œì™€ì˜ ê±°ë¦¬ ê³„ì‚°
          const prevPos = L.latLng(path[path.length - 1]);
          const newPos = L.latLng(currentPos);
          const distance = prevPos.distanceTo(newPos); // ë¯¸í„° ë‹¨ìœ„
          totalDistance += distance;
        }
        path.push(currentPos);

        // polyline ì—…ë°ì´íŠ¸
        polyline.setLatLngs(path);

        // ê±°ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì†Œìˆ˜ì  ë²„ë¦¼)
        distanceDiv.textContent = "ì´ ì´ë™ ê±°ë¦¬: " + Math.floor(totalDistance) + " m";
      },
      (err) => {
        alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + err.message);
      },
      { enableHighAccuracy: true }
    );
  </script>
</body>
</html>